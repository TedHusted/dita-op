<?xml version="1.0" encoding="UTF-8"?>
<!--
    Copyright (C) 2008 Claude Vedovini <http://vedovini.net/>.
    
	This file is part of the DITA Open Platform <http://www.dita-op.org/>.
	
	The DITA Open Platform is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.
	
	The DITA Open Platform is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.
	
	You should have received a copy of the GNU General Public License
	along with The DITA Open Platform.  If not, see <http://www.gnu.org/licenses/>.
-->
<project name="dita2wp" default="dita2wordpress">
	
    <target name="dita2wordpress"
      depends="build-init, preprocess, dita.map.wp, copy-revflag, 
                     dita.topics.wp, dita.inner.topics.wp, dita.outer.topics.wp">
    </target>

    <target name="dita.map.wp"
            depends="dita.map.wp.init, dita.map.wp.toc , dita.out.map.wp.toc" />

    <target name="dita.map.wp.init" description="">
        <condition property="out.ext" value=".php">
            <not>
                <isset property="out.ext" />
            </not>
        </condition>
        <condition property="args.wp.toc" value="index">
            <not>
                <isset property="args.wp.toc" />
            </not>
        </condition>
	</target>
  	
    <target name="dita.map.wp.toc"
            unless="noMap" if="old.transform"
            description="Build WP TOC file">
        <xslt processor="trax"
              basedir="${dita.temp.dir}"
              destdir="${output.dir}"
              includes="${user.input.file}"
              classpathref="dost.class.path"
              style="plugins${file.separator}dita2wp${file.separator}xsl${file.separator}map2wptoc.xsl">
            <param name="WPPATH" expression="${args.wppath}" if="args.wppath" />
            <param name="WPPAGE" expression="${args.wppage}" />
            <param name="WPCONTENTCLASS" expression="${args.wpcontent.class}" if="args.wpcontent.class" />
            <param name="DITAEXT" expression="${dita.ext}" if="dita.ext" />
            <param name="OUTEXT" expression="${out.ext}" if="out.ext" />
            <mapper type="glob"
                    from="*${dita.input.filename}"
                    to="*${args.wp.toc}${out.ext}" />
        </xslt>
	</target>

    <target name="dita.out.map.wp.toc"
            unless="noMap" if="inner.transform"
            description="Build WP TOC file, which will adjust the directory">
        <xslt processor="trax"
              basedir="${dita.temp.dir}"
              destdir="${output.dir}"
              includes="${user.input.file}"
              classpathref="dost.class.path"
              style="plugins${file.separator}dita2wp${file.separator}xsl${file.separator}map2wptoc.xsl">
            <param name="WPPATH" expression="${args.wppath}" if="args.wppath" />
            <param name="WPPAGE" expression="${args.wppage}" />
            <param name="WPCONTENTCLASS" expression="${args.wpcontent.class}" if="args.wpcontent.class" />
            <param name="DITAEXT" expression="${dita.ext}" if="dita.ext" />
            <param name="OUTEXT" expression="${out.ext}" if="out.ext" />
            <mapper type="glob"
                    from="${user.input.file}"
                    to="${args.wp.toc}${out.ext}" />
        </xslt>
    </target>

  <target name="dita.topics.wp" unless="noTopic" if="old.transform"
          description="Build WP files from inner and outer dita topics, which will adjust the directory. ">
    <condition property="out.ext" value=".php">
      <not>
        <isset property="out.ext"></isset>
      </not>
    </condition>
    <condition property="args.xsl" value="plugins${file.separator}dita2wp${file.separator}xsl${file.separator}dita2wp.xsl">
        <not>
            <isset property="args.xsl" />
        </not>
    </condition>
    <xslt processor="trax" basedir="${dita.temp.dir}" destdir="${output.dir}"
          includes="${fullditatopiclist} ${chunkedtopiclist}" classpathref="dost.class.path"
          extension="${out.ext}" style="${args.xsl}">
      <param name="DITAEXT" expression="${dita.ext}" if="dita.ext"></param>
      <param name="FILTERFILE" expression="${dita.input.valfile}" if="dita.input.valfile"></param>
      <param name="WPPATH" expression="${args.wppath}" if="args.wppath" />
      <param name="WPPAGE" expression="${args.wppage}" />
      <param name="WPCONTENTCLASS" expression="${args.wpcontent.class}" if="args.wpcontent.class" />
      <param name="HDF" expression="${args.hdf}" if="args.hdf"></param>
      <param name="HDR" expression="${args.hdr}" if="args.hdr"></param>
      <param name="FTR" expression="${args.ftr}" if="args.ftr"></param>
      <param name="DRAFT" expression="${args.draft}" if="args.draft"></param>
      <param name="ARTLBL" expression="${args.artlbl}" if="args.artlbl"></param>
      <param name="OUTEXT" expression="${out.ext}" if="out.ext"></param>
	  
      <param name="INDEXSHOW" expression="${args.indexshow}" if="args.indexshow"></param>
    </xslt>
  </target>

  <target name="dita.inner.topics.wp" unless="noTopic" if="inner.transform"
          description="Build WP files from inner dita topics">
    <condition property="out.ext" value=".php">
      <not>
        <isset property="out.ext"></isset>
      </not>
    </condition>
    <condition property="args.xsl" value="plugins${file.separator}dita2wp${file.separator}xsl${file.separator}dita2wp.xsl">
      <not>
        <isset property="args.xsl"></isset>
      </not>
    </condition>
    <xslt processor="trax" basedir="${dita.temp.dir}" destdir="${output.dir}"
          includes="${fullditatopiclist} ${chunkedtopiclist}" classpathref="dost.class.path"
          extension="${out.ext}" style="${args.xsl}">
      <param name="DITAEXT" expression="${dita.ext}" if="dita.ext"></param>
      <param name="FILTERFILE" expression="${dita.input.valfile}" if="dita.input.valfile"></param>
      <param name="WPPATH" expression="${args.wppath}" if="args.wppath" />
      <param name="WPPAGE" expression="${args.wppage}" />
      <param name="WPCONTENTCLASS" expression="${args.wpcontent.class}" if="args.wpcontent.class" />
      <param name="HDF" expression="${args.hdf}" if="args.hdf"></param>
      <param name="HDR" expression="${args.hdr}" if="args.hdr"></param>
      <param name="FTR" expression="${args.ftr}" if="args.ftr"></param>
      <param name="DRAFT" expression="${args.draft}" if="args.draft"></param>
      <param name="ARTLBL" expression="${args.artlbl}" if="args.artlbl"></param>
      <param name="OUTEXT" expression="${out.ext}" if="out.ext"></param>
	  
      <param name="INDEXSHOW" expression="${args.indexshow}" if="args.indexshow"></param>
      <mapper type="regexp" from="^(${tempdirToinputmapdir.relative.value})(.*?)(\.(xml|dita))$$" to="\2${out.ext}"></mapper>
    </xslt>
  </target>

  <target name="dita.outer.topics.wp" unless="noTopic" if="outer.transform" depends="checkouterTransform"
          description="Build HTML files from outer dita topics">
    <condition property="out.ext" value=".php">
      <not>
        <isset property="out.ext"></isset>
      </not>
    </condition>
    <condition property="args.xsl" value="plugins${file.separator}dita2wp${file.separator}xsl${file.separator}dita2wp.xsl">
      <not>
        <isset property="args.xsl"></isset>
      </not>
    </condition>
    <xslt processor="trax" basedir="${dita.temp.dir}" destdir="${output.dir}${file.separator}${uplevels}"
          includes="${outditafileslist}" classpathref="dost.class.path" extension="${out.ext}" style="${args.xsl}">
      <param name="DITAEXT" expression="${dita.ext}" if="dita.ext"></param>
      <param name="FILTERFILE" expression="${dita.input.valfile}" if="dita.input.valfile"></param>
      <param name="WPPATH" expression="${args.wppath}" if="args.wppath" />
      <param name="WPPAGE" expression="${args.wppage}" />
      <param name="WPCONTENTCLASS" expression="${args.wpcontent.class}" if="args.wpcontent.class" />
      <param name="HDF" expression="${args.hdf}" if="args.hdf"></param>
      <param name="HDR" expression="${args.hdr}" if="args.hdr"></param>
      <param name="FTR" expression="${args.ftr}" if="args.ftr"></param>
      <param name="DRAFT" expression="${args.draft}" if="args.draft"></param>
      <param name="ARTLBL" expression="${args.artlbl}" if="args.artlbl"></param>
      <param name="OUTEXT" expression="${out.ext}" if="out.ext"></param>
	  
      <param name="INDEXSHOW" expression="${args.indexshow}" if="args.indexshow"></param>
    </xslt>
  </target>
  
</project>
